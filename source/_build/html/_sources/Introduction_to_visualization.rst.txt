5. Introduction to visualization
================================

In this chapter we will introduce you to the visualization on Rviz. It is a great tool for ROS, used by many to debug code or to have some nice
visualization of your simulations.

5.1 The beginning
-----------------

First, especially if you never run any simulation using Rviz, we recommand you to try some CTU MRS simulation.
To do that you can run these commands: ::

    cd ~/mrs_workspace/src/simulation/example_tmux_scripts/one_drone_gps
    ./stat.sh

The Rviz window will open after after gazebo and it look like that :

.. figure:: _static/one_drone_rviz.png
   :width: 800
   :align: center

   Figure 5.1: Rviz window

You can see arrows, poses, UAV frames in this simple visualization.
For these simple tasks you only need to click on the add button and subscribe to the topic you want to visualize.

.. figure:: _static/add_button.png
   :width: 500
   :align: center

   Figure 5.2: Add button

.. figure:: _static/topic_window.png
   :width: 800
   :align: center

   Figure 5.3: Topic window

You can also use the 2D Nav Goal button to choose a position and a heading to go for the UAV.

.. figure:: _static/navgoal_button.png
   :width: 500
   :align: center

   Figure 5.4: Navigation goal button

Next, you can run some simulations which use dedicated plugins for one specific task.
You will need to use these commands: ::

    cd ~/mrs_workspace/src/uav_core/ros_packages/mrs_uav_testing/tmux
    ls

It will show you the different simulation that you can test. You can do it by using ``cd ./"directory_of_the_simulation"`` and running: ::

    ./start.sh

The bumper simulation is an example of advanced task that you can do on Rviz, it is made by a plugin created from scratch.
It represent a huge work to create these type of visualization but it shows you the diversity of possibilities.

5.2 How Rviz works ?
--------------------

5.2.1 Launching Rviz
^^^^^^^^^^^^^^^^^^^^

To run a simulation, you will use the ``start.sh`` file wich will ask to the ``session.yml`` what ``.launch`` file are going to be runned.
A ``.yml`` looks like this :

.. figure:: _static/yml_file.png
   :width: 800
   :align: center

   Figure 5.5: .yml file

You can see that there is an Rviz part. 
The first line ask for the ``rviz.launch`` file which is used to choose the ``.rviz`` file that you want to use. This type of file is used to save
the configuration of Rviz, like what is displayed. On the testing_brubotics package there is the ``rviz`` directory which contains all the ``.rviz`` files.

You can generate a ``.rviz`` file, which save your Rviz configuration, by clicking in Rviz on ``File->Save config as``.


5.2 Our work
------------

We wanted to visualize what it is computed by the D-ERG tracker of BruBotics especially in the simulation that you can run with these commands: ::

    cd ~workspace/src/droneswarm_brubotics/ros_packages/testing_brubotics/tmux_scripts/2_two_drones_D-ERG/
    ./start.sh


