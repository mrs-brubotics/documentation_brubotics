

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>6. Crazyswarm &mdash; DroneSwarmTutorial 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="For developers" href="For_developers.html" />
    <link rel="prev" title="5. Introduction to visualization" href="Introduction_to_visualization.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> DroneSwarmTutorial
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Prerequisites.html">2. Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="Introduction_to_MRS_Software_Extensions.html">3. Introduction to MRS Software Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Workspace_git_configuration.html">4. Workspace Git configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Introduction_to_visualization.html">5. Introduction to visualization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6. Crazyswarm</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">6.1 Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">6.2 Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vicon">6.3 Vicon</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#working-principle">6.3.1 Working principle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hardware">6.3.2 Hardware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#software">6.3.3 Software</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calibration-of-the-vicon-system">6.3.3 Calibration of the Vicon System</a></li>
<li class="toctree-l3"><a class="reference internal" href="#new-part">6.3.4 New part</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="For_developers.html">For developers</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">DroneSwarmTutorial</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>6. Crazyswarm</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Crazyswarm.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="crazyswarm">
<h1>6. Crazyswarm<a class="headerlink" href="#crazyswarm" title="Permalink to this headline">¶</a></h1>
<p><em>This chapter will move on to another documentation.</em></p>
<div class="section" id="installation">
<h2>6.1 Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>To install Crazyswarm, follow <a class="reference external" href="https://crazyswarm.readthedocs.io/en/latest/installation.html">these steps</a>. We use Ubuntu 20.04, Pyhton 3.7 and ROS Noetic.
Please refer to the <em>Physical Robots and Simulation</em> part. Don’t forget to replace what is between brackets in the commands.</p>
<p>To switch between Python2 and Python3 on Ubuntu 20.04, please ckeck <a class="reference external" href="https://www.fosslinux.com/39384/switching-between-python-2-and-3-versions-on-ubuntu-20-04.htm">this website</a>.</p>
<p>At the third step, you might get this error:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>E: Unable to locate package gcc-arm-embedded
</pre></div>
</div>
<p>To solve this issue, you just have to remove <code class="docutils literal notranslate"><span class="pre">gcc-arm-embedded</span></code> from the command.</p>
<p>To install the Crazyflie Client, we recommend you to do it with the <em>Ubuntu Software application</em>.</p>
</div>
<div class="section" id="configuration">
<h2>6.2 Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Now, configuration is needed before flying. You should refer to this <a class="reference external" href="https://www.bitcraze.io/documentation/repository/crazyflie-clients-python/master/userguides/userguide_client/">user guide</a>
to <a class="reference external" href="https://www.bitcraze.io/documentation/repository/crazyflie-clients-python/master/userguides/userguide_client/#firmware-upgrade">update the firmware</a> (it
is also good for you if you read <a class="reference external" href="https://crazyswarm.readthedocs.io/en/latest/configuration.html#">this</a>).</p>
<p>If you can’t connect to the CF, you probably need to run this command:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> crazyswarm/crazyflie-lib-python/examples
python3 write-eeprom.py
</pre></div>
</div>
<p>You could get this error as a result:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Scanning interfaces <span class="k">for</span> Crazyflies...
Cannot find a Crazyradio Dongle
Crazyflies found:
No Crazyflies found, cannot run example
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;write-eeprom.py&quot;</span>, line <span class="m">148</span>, in &lt;module&gt;
     <span class="k">while</span> le.is_connected:
NameError: name <span class="s1">&#39;le&#39;</span> is not defined
</pre></div>
</div>
<p>If so, set the USB permissions as described <a class="reference external" href="https://www.bitcraze.io/documentation/repository/crazyflie-lib-python/master/installation/usb_permissions/">here</a>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> crazyswarm/crazyflie-lib-python/examples
python3 write-eeprom.py
</pre></div>
</div>
</div>
<div class="section" id="vicon">
<h2>6.3 Vicon<a class="headerlink" href="#vicon" title="Permalink to this headline">¶</a></h2>
<p>Vicon is a developer of motion capture products and services for the life science, entertainment, and engineering industries. Motion capture (mocap) is the
process of recording the movement of objects or people. The technology originated in the life science market for gait analysis but is now used widely by VFX
studios, sports therapists, neuroscientists, and for validation and control of computer vision and robotics.
More information about Vicon can be found on <a class="reference external" href="https://www.vicon.com">Vicon website</a>.</p>
<div class="section" id="working-principle">
<h3>6.3.1 Working principle<a class="headerlink" href="#working-principle" title="Permalink to this headline">¶</a></h3>
<p>The Vicon motion capture system is a passive optical system. This technique uses retroreflective markers that are tracked by the infrared cameras by reflecting
the light that is generated near the cameras’ lens. The camera’s threshold can be adjusted so only the bright reflective markers will be sampled, ignoring
skin and fabric.</p>
<p>The set of infrared cameras are placed around the to-be-captured area and are more or less pointing to the center of this area as depicted in Fig. 6.1. The
goal is that the markers in the captured volume can be seen by as many cameras as possible. We need at least two cameras to know the position of one marker,
but it is recommended to use as many cameras as possible, because the more cameras can capture a marker, the higher the accuracy of that marker’s position and
the lower the possibility the position of that marker is lost. If we only use markers on the floor (i.e. in a 2D plane) without people or objects around so
that the markers can never be occluded, we can use only 3 cameras and have good results. In more difficult situations with markers evolving in 3D, people or
objects hiding one of the cameras, the number of cameras needed can increase quickly.</p>
<p>In the R&amp;MM lab we are using 10 cameras. This is ok for the experiments we have executed. For experiments where full coverage around the to-be-captured subject
is required, more cameras will be needed.</p>
<div class="figure align-center" id="id1">
<img alt="alternate text" src="_images/Vicon_working_principle.png" />
<p class="caption"><span class="caption-text">Fig. 6.1: Vicon Working principle</span></p>
</div>
<p>More information can be found <a class="reference external" href="https://www.vicon.com/what-is-motion-capture">here</a>.</p>
</div>
<div class="section" id="hardware">
<h3>6.3.2 Hardware<a class="headerlink" href="#hardware" title="Permalink to this headline">¶</a></h3>
<p>6.3.2.1 Cameras</p>
<p>At the R&amp;MM lab there are ten Vero v2.2 cameras with a resolution of 1280*1024 pixels and a frame rate of 250fps. The higher the resolution of the camera, the
preciser the positioning of the markers and the more details you can obtain from the markers which is interesting when using very small markers placed close to
each other. The higher the frame rate, the easier to track the quick movements of the markers, which is also needed to use position of markers in a feedback
loop with high sampling time.</p>
<p>The placement of the cameras really depends on the experiment we want to carry out. In the lab the cameras can be placed onto the walls and on a tripods. In
the future it could be useful to have all of them on tripod to be able to change their places easily and quickly.</p>
<div class="figure align-center" id="id2">
<img alt="alternate text" src="_images/Vicon_cameras.png" />
<p class="caption"><span class="caption-text">Fig. 6.2: Vicon cameras</span></p>
</div>
<p>6.3.2.2 Sync box</p>
<p>As can be seen in Fig. 2.1, all cameras and the PC are connected to the synch box in order to get data coming from cameras and sending this to the PC. The sync
box provides a single communication point between the cameras and the (Vicon) PC. If you’re not integrating third-party equipment like reference video or force
plates into your system, this could be as simple as a POE switch. The real difference with the various sync boxes offered by manufacturers comes when you need
to integrate fully synchronized third-party devices or require time-code. Vicon’s Lock+ sync box offer many features such as Timecode, Genlock, VESA and
synchronized triggering of your third-party devices.</p>
<p>More information can be found <a class="reference external" href="https://www.vicon.com/products/vicon-devices/lock-sync-box">here</a>.</p>
<div class="figure align-center" id="id3">
<img alt="alternate text" src="_images/Sync_box.png" />
<p class="caption"><span class="caption-text">Fig. 6.3: Cameras connected to the synch box</span></p>
</div>
<p>6.3.2.3 Active wand</p>
<p>Before using Vicon we need to calibrate the Vicon system in order that the cameras know their location relative to each other.</p>
<p>Before starting with the calibration, we first have to mask all reflective elements (e.g. the cameras themselves, maybe clothes or shoes with that reflect
infrared light) in the Vicon room, so no reflective markers that you will use may be visible for the cameras. To start the calibration, press start in the
<em>Calibrate Camera</em> menu. Thereafter, start waving the wand in the room. The system will acquire many frames and after having captured more than 2000 frames for
each camera the calibration is finished. There are two operating modes for different light condition. This means you can calibrate your motion capture cameras
whether you are inside or outside in the brilliant sunshine. To optimize the process, the active wand automatically synchronizes itself by the use of a
photo-diode.</p>
<p>The precision and repeatability of your data is dependent on your system calibration. The LEDs on Vicon’s Active Wand are machined placed and precision
engineered to give you a more precise overall calibration. The Active Wand calibrates both optical and video cameras while accounting for sensor edge
distortion at the same time, to ensure synchronized overlay across your entire volume. Notice that better results will be obtained when the active wand is
visible to as many cameras as possible during the waving process. The more cameras see the waving movement of the active wand at a certain time, the better
they can compute the position relative to each other.</p>
<p>More information can be found <a class="reference external" href="https://www.vicon.com/products/vicon-devices/calibration">here</a>.</p>
<div class="figure align-center" id="id4">
<img alt="alternate text" src="_images/Active_wand.png" />
<p class="caption"><span class="caption-text">Fig. 6.4: Active Wand</span></p>
</div>
<p>6.3.2.4 Reflective Markers</p>
<p>The reflective markers are placed on objects or on the body in order to detect their position. In order to detect pose (i.e position and orientation) of a
rigid object we need at least 3 markers. The position of the markers w.r.t. each other needs to be asymmetrical, in other words you may not form an equilateral
triangle.</p>
<div class="figure align-center" id="id5">
<img alt="alternate text" src="_images/Markers.png" />
<p class="caption"><span class="caption-text">Fig. 6.5: Markers</span></p>
</div>
<p>6.3.2.5 Computer</p>
<p>The computer gives us the possibility to drive the Vicon system, calibrate, organize data capture, set parameters. Since the capture and display of motion
capture data is a highly demanding task for a PC and the real-time data processing asks a lot of the processor, the recommended specifications of the computer
are:
* Dell Precision XL Tower 5820</p>
<ul class="simple">
<li>Intel Xeon Processor W-2123 (3.6GHz, 3.9GHz Turbo, 4C, 8.25M Cache)</li>
<li>16GB (2x8GB) 2666MHz DDR4 RDIMM ECC</li>
<li>2 x 2TB 3.5inch Serial ATA (7,200 Rpm) Hard Drive</li>
<li>Non RAID</li>
<li>8x Slimline DVD+/-RW Drive</li>
<li>2 GB NVIDIA Quadro P600</li>
<li>Windows 10 Pro English</li>
<li>INTEL ETHERNET i350 T4 SERVER ADAPTER RJ45 PCI−E – to connect Vicon System</li>
</ul>
<p>More information can be found <a class="reference external" href="https://www.vicon.com/faqs/operating-systems-and-pc-specification/what-is-the-recommended-pc-specification-to-run-my-vicon-tracker-system">here</a>.</p>
</div>
<div class="section" id="software">
<h3>6.3.3 Software<a class="headerlink" href="#software" title="Permalink to this headline">¶</a></h3>
<p>Vicon offers several software packages, each of them for <a class="reference external" href="https://www.vicon.com/products/software">different applications</a>.
Two of them are explained beheight: 400
:width: 400
<a class="reference external" href="https://www.vicon.com/products/software/tracker">Tracker</a> is designed for engineering applications. It can be used for robot tracking, human factors
engineering, design method optimization, virtual engineering, and previsualization to virtual reality. It looks better to use for the experiments we execute,
but we were also able to use Nexus.</p>
<div class="figure align-center" id="id6">
<img alt="alternate text" src="_images/Tracker.png" />
<p class="caption"><span class="caption-text">Fig. 6.7: Tracker</span></p>
</div>
</div>
<div class="section" id="calibration-of-the-vicon-system">
<h3>6.3.3 Calibration of the Vicon System<a class="headerlink" href="#calibration-of-the-vicon-system" title="Permalink to this headline">¶</a></h3>
<p>The <em>Mask cameras</em> function is used to make camera don’t care about area where infrared signal is not significant. Because vicon can believed there are markers
in this area but it is not the case. So when we use this function we have to be sure no markers are in the vision field of cameras.</p>
<p>Then, check that the cameras look in the direction where your Crazyflies will move. When it is good, you can <em>Start</em> to <em>Aim Cameras</em>.</p>
<p>In order to calibrate the cameras, press <em>Start</em> in the <em>Calibrate Cameras</em> menu and wave with the active wand in the to-be-captured area, i.e. where you want to
detect reflection markers. You should draw “∞” forms. In <em>Show Advances</em>, you must have at least <em>Refinement frames: 2000</em>. Cameras are blinking during this
process and are all turned green when the process is finished.</p>
<p>In order to set the origin of the Vicon system, click <em>Start</em> in the <em>Set Volume Origin</em> menu. We usually use the active wand, but there are also others methods in
advanced options. Leave the active wand where you want (make sure it is in the camera view of all cameras) and press <em>Set the origin</em>. Now your Vicon system is
ready to use. To calibrate the system we can also adjust the focal of cameras.
During using of the Vicon sometimes cameras blink red, it means the camera pose has changed. Most of the time it is only due to vibration so it do not affect
the capture.</p>
<div class="figure align-center" id="id7">
<img alt="alternate text" src="_images/System_preparation_menu.png" />
<p class="caption"><span class="caption-text">Fig. 6.8: Example of system preparation menu</span></p>
</div>
</div>
<div class="section" id="new-part">
<h3>6.3.4 New part<a class="headerlink" href="#new-part" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="For_developers.html" class="btn btn-neutral float-right" title="For developers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Introduction_to_visualization.html" class="btn btn-neutral float-left" title="5. Introduction to visualization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, BruBotics.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>